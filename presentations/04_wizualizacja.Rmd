---
title: "Podstawy programowania"
subtitle: "Wizualizacja danych"
author: "&copy; Łukasz Wawrowski"
date: ""
output:
  xaringan::moon_reader:
    css: ["default.css", "default-fonts.css"]
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r include=FALSE}
library(tidyverse)
library(countdown)
```

# Rozpoczynanie pracy z R

.pull-left[
__Nowy projekt__

1. Otwórz RStudio
2. Stwórz nowy projekt
3. Przenieś dane do folderu projektu
4. Otwórz nowy skrypt R
5. Wczytaj biblioteki
6. Wczytaj dane
7. Analizuj

]

.pull-right[
__Istniejący projekt__

1. Otwórz RStudio
2. Otwórz istniejący skrypt R
3. Wczytaj biblioteki
4. Wczytaj dane
5. Kontyuuj analizę

]

---

# Źródła wiedzy

- [Przewodnik po wizualizacji danych](https://www.data-to-viz.com/)

- [Fundamentals of Data Visualization](https://serialmentor.com/dataviz/)

- [Color Brewer](http://colorbrewer2.org)

---

# Proste wykresy

- `plot()` - wykres punktowy/liniowy

- `hist()` - histogram

- `barplot()` - wykres kolumnowy

- `boxplot()` - wykres pudełkowy

---

class: inverse

# Wczytanie danych

1. Ściągnij zbiór `rossmann.xlsx` i umieść w folderze `data`

2. Utwórz nowy skrypt i wczytaj biblioteki `tidyverse` i `readxl`

3. Wczytaj zbiór danych `rossmann.xlsx` do pamięci R

4. Wybierz jeden ze sklepów

5. Stwórz kilka wykresów

`r countdown(minutes = 10, seconds = 0, top = 0)`

---

# Problemy z nazwami zmiennych

- nazwy zmiennych nie powinny zawierać polskich liter i spacji

- nazwy zmiennych nie powinny zaczynać się od liczby

- surowe dane zwykle nie posiadają nazw kolumn przystosowanych do przetwarzania przez komputer

- ten problem rozwiązuje pakiet _janitor_ i funkcja `clean_names()`:

```

zbior <- janitor::clean_names(zbior)

```

- funkcja ta zamienia wielkie litery na małe, spacje na podkreślniki i znaki transliteruje do ASCII.

---

# Wczytanie danych

```{r warning=FALSE, fig.height=4}
library(tidyverse)
library(readxl)

rossmann <- read_xlsx("../data/rossmann.xlsx")
sklep11 <- rossmann %>%
  filter(sklep_id == 11, czy_otwarty == "Tak")

plot(sklep11$sprzedaz, sklep11$liczba_klientow)
```

---

# Pakiet `ggplot2`

Tworzenie wykresów poprzez dodawanie (`+`) kolejnych warstw.

- [dokumentacja](https://ggplot2.tidyverse.org/)

- [cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)

- [rozszerzenia](http://www.ggplot2-exts.org/gallery/)

- [top 50](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html)

- [wykresy krok po kroku](https://evamaerey.github.io/ggplot_flipbook/ggplot_flipbook_xaringan.html)

???

Pierwsza wersja 10.06.2007

---

# Niezbędny kod

```{r eval=FALSE}
ggplot(data = zbior_danych, aes(x = cecha1, y=cecha2))
```


- x - zawartość osi x

- y - zawartość osi y

- fill - wypełnienie

- size - rozmiar

- color - kolor

- shape - kształt

---

# Wykres punktowy - `geom_point`

Obowiązkowe argumenty `aes`:

- x 

- y

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point()
```

]

.pull-right[

```{r echo=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point()
```

]

---

# Dodatkowe elementy

- `xlim(0,10)` - minimum i maksimum osi x

- `ylim(-5,5)` - minimum i maksimum osi y

- `xlab("tekst")` - etykieta osi x

- `ylab("tekst")` - etykieta osi y

- `ggtitle("tekst")` - tytuł wykresu

- `labs(subtitle = "tekst")` - podtytuł

- `labs(caption = "tekst")` - podpis

- `coord_flip()` - obraca wykres

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż")

```

]

.pull-right[

```{r echo=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż")
```

]

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż") +
  ylim(0,20000) 

```

]

.pull-right[

```{r echo=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż") +
  ylim(0,20000) 
```

]
---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż") +
  ylim(0,20000) +
  ggtitle("Sprzedaż i liczba klientów w sklepie nr 11")
```

]

.pull-right[

```{r echo=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż") +
  ylim(0,20000) +
  ggtitle("Sprzedaż i liczba klientów w sklepie nr 11")
```

]
---

# Motywy

- theme_bw
- theme_classic
- theme_dark
- theme_gray - domyślnie
- theme_light
- theme_linedraw
- theme_minimal
- theme_void

Powyższe motywy są zaimplementowane w pakiecie ggplot2, ale można także skorzystać z dodatkowych pakietów:

- [theme_bbc](https://github.com/bbc/bbplot)
- [theme_xkcd](https://cran.r-project.org/web/packages/xkcd/)

Albo stworzyć [swój własny motyw](https://www.statworx.com/de/blog/custom-themes-in-ggplot2/).

---

class: inverse

# Zadanie 

Przetestuj kilka motywów i wybierz jeden z nich.

`r countdown(minutes = 5, seconds = 0, top = 0)`

---

# Zapisywanie wykresu

- w zakładce Plots -> Export

- funkcja `ggsave()`

   - `filename` - nazwa pliku z rozszerzeniem (png, pdf)
   
   - `width` i `height` - szerokość i wysokość (domyślnie w calach)
   
   - `scale` - skalowanie po zmianie rozdzielczości
   
   - `dpi` - liczba punktów na cal


---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż") +
  ylim(0,20000) +
  ggtitle("Sprzedaż i liczba klientów w sklepie nr 11") +
  theme_light() +
  ggsave("figs/sklep11.png", 
         width = 12, 
         height = 10, 
         scale = 0.5, 
         dpi = 1200)

```

]

.pull-right[

```{r echo=FALSE}
ggplot(sklep11, aes(x=liczba_klientow, 
                    y=sprzedaz)) + 
  geom_point() +
  xlab("Liczba klientów") +
  ylab("Sprzedaż") +
  ylim(0,20000) +
  ggtitle("Sprzedaż i liczba klientów w sklepie nr 11") +
  theme_light() +
  ggsave("figs/sklep11.png", 
         width = 12, 
         height = 10, 
         scale = 0.5, 
         dpi = 1200)
```

]
---

# Dodanie zmiennej płeć

W zbiorze danych zmienna płeć ma typ `haven_labelled`, który nie jest obsługiwany przez pakiet ggplot2 - trzeba zamienić na zmienną tekstową z wykorzystaniem funkcji `as.character()`.

.pull-left[

![](img/haven_labelled.png)

]

.pull-right[

```{r}
psycho <- psycho %>% 
  mutate(plec=as.character(plec))
```

]

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = 
          element_text(hjust = 0.5))
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd, 
                color = plec)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5))
```

]

---

# Etykiety zmiennej

W celu zdefiniowania etykiet dla zmiennej płeć należy zmienić jej typ na _faktor_:

```{r}
psycho <- psycho %>% 
  mutate(plec_fct=factor(x = plec,
                         levels = c("1", "2"), 
                         labels = c("Kobieta", "Mężczyzna"), 
                         ordered = F))

```

Za pomocą argumentu `ordered` można tworzyć cechy nominalne (`TRUE`) lub porządkowe (`FALSE`).

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=poczucie_winy,
                  y=wstyd,
                  color = plec_fct)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = 
          element_text(hjust = 0.5))
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd, 
                color = plec_fct)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5))
```

]
---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec_fct)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = 
          element_text(hjust = 0.5))
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd, 
                color = plec_fct)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5))
```

]
---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec_fct)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = 
          element_text(hjust = 0.5))
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd, 
                color = plec_fct)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5))
```

]
---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec_fct)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = 
          element_text(hjust = 0.5),
        legend.position = "bottom")
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd, 
                color = plec_fct)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "bottom")
```

]

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec_fct)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = 
          element_text(hjust = 0.5),
        legend.position = c(0.08,0.87))
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd, 
                color = plec_fct)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = c(0.08,0.87))
```

]

---

class: inverse

# Zadanie

Dodaj do zbioru danych identyfikator jednostek.

`r countdown(minutes = 5, seconds = 0, top = 0)`

---

# Dodanie identyfikatora

Funkcja `nrow()` zwraca liczbę wierszy w podanym zbiorze danych.

```{r}
psycho <- psycho %>%
  mutate(id=1:nrow(.)) # nrow(psycho)
```

---

# Wykresy interaktywne

_Plotly_ to biblioteka do wykresów, która posiada swoją własną składnię.

Za pomocą funkcji `ggplotly()` można zamienić każdy wykres ggplot2 na wykres interaktywny.

---

# Wykres punktowy

.pull-left[

```{r eval=FALSE}
p <- ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec_fct,
                label = id)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light()

plotly::ggplotly(p)
```

]

.pull-right[

```{r echo=FALSE}
p <- ggplot(psycho, aes(x=poczucie_winy, 
                y=wstyd,
                color = plec_fct,
                label = id)) + 
  geom_point() +
  xlab("Poczucie winy") +
  ylab("Wstyd") +
  ylim(0,40) +
  scale_color_discrete(name = "Płeć") +
  ggtitle("Poczucie winy i wstyd") +
  theme_light()

plotly::ggplotly(p)
```

]
---

# Histogram - `geom_histogram`

Obowiązkowe argumenty `aes`:

- x 

Domyślnie tworzy zawsze 30 słupków.

---

# Histogram

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram()
```

Domyślnie tworzonych jest 30 słupków.

]

.pull-right[

```{r echo=FALSE, message=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram()
```

]

---

# Histogram - 12 słupków

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram(bins = 12)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram(bins = 12)
```

]

---

# Histogram - słupek = 1 rok

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram(binwidth = 1)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram(binwidth = 1)
```

]

---

# Histogram - fill jako zmienna

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek, 
                   fill = plec_fct)) + 
  geom_histogram(binwidth = 1)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek, 
                   fill = plec_fct)) + 
  geom_histogram(binwidth = 1)
```

]

---

# Histogram - fill jako kolor

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram(binwidth = 1, 
                 fill = "blue")
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_histogram(binwidth = 1, fill = "blue")
```

]

---

# Krzywa normalna

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x=wstyd)) + 
  geom_histogram(aes(y =..density..), 
                 binwidth = 1) +
  stat_function(fun = dnorm, 
                size = 1, 
    args = list(mean = 
                  mean(psycho$wstyd), 
                sd = 
                  sd(psycho$wstyd)))
```


]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x=wstyd)) + 
  geom_histogram(aes(y =..density..), binwidth = 1) +
  stat_function(fun = dnorm, size = 1, 
      args = list(mean = mean(psycho$wstyd), 
                  sd = sd(psycho$wstyd)))
```

]

---

# Krzywa gęstości

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_density(fill = "blue")
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek)) + 
  geom_density(fill = "blue")
```

]

---

# Wykres kwantyl-kwantyl

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(sample=wiek)) + 
  stat_qq() + 
  stat_qq_line()
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(sample=wiek)) + 
  stat_qq() + 
  stat_qq_line()
```

]

---

class: inverse

# Zadanie

Stwórz zmienną `wiek4`, która będzie zawierała 4 grupy wieku.

`r countdown(minutes = 10, seconds = 0, top = 0)`

???

```{r}
psycho <- psycho %>%
  mutate(plec=factor(plec, levels = c(1,2), labels = c("Kobieta", "Mężczyzna")))

psycho <- psycho %>%
  mutate(wiek4 = cut(wiek, breaks = c(18,24,30,36,42), include.lowest = T))
```


---

# Grupy wieku

Funkcja `cut()` pozwala na stworzenie zmiennej jakościowej z ilościowej:

```{r}
psycho <- psycho %>%
  mutate(wiek4=cut(x = wiek, 
                   breaks = c(18,24,30,36,42), 
                   include.lowest = T))
```

Przy większej liczbie kategorii warto skorzystać z funkcji `seq()`:

```{r}
psycho <- psycho %>%
  mutate(wiek4=cut(x = wiek, 
                   breaks = seq(from = 18, to = 42, by = 6), 
                   include.lowest = T))
```

---

# Wykres słupkowy - `geom_bar` / `geom_col`

- `geom_bar` - funkcja sama oblicza wartości do wyświetlenia na podstawie zbioru danych jednostkowych

- `geom_col` - funkcja otrzymuje już obliczone wartości (dane zagregowane)

---

# Wykres słupkowy - `geom_bar`

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek4)) +
  geom_bar()
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek4)) +
  geom_bar()
```

]


---

# Wykres słupkowy - `geom_bar`

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = wiek4)) +
  geom_bar(fill = "#99d8c9")
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = wiek4)) +
  geom_bar(fill = "#99d8c9")
```

]

---

# Wykres słupkowy - `geom_col`

.pull-left[

```{r eval=FALSE}
n_wiek4 <- psycho %>%
  count(wiek4)

ggplot(n_wiek4, aes(x = wiek4, 
                    y = n)) +
  geom_col()
```

]

.pull-right[

```{r echo=FALSE}
n_wiek4 <- psycho %>%
  count(wiek4)

ggplot(n_wiek4, aes(x = wiek4, 
                    y = n)) +
  geom_col()

```

]

---

# Wykres słupkowy - `geom_col`

.pull-left[

```{r eval=FALSE}
wstyd_wiek4 <- psycho %>%
  group_by(wiek4) %>%
  summarise(srednia=mean(wstyd),
            odch=sd(wstyd),
            blad_sr=sd(wstyd)/sqrt(n()))

ggplot(wstyd_wiek4, aes(x = wiek4, 
                        y = srednia)) +
  geom_col() + 
  geom_errorbar(aes(ymin = srednia - odch, 
                    ymax = srednia + odch), 
                width = 0.5)

```

]

.pull-right[

```{r echo=FALSE}
wstyd_wiek4 <- psycho %>%
  group_by(wiek4) %>%
  summarise(srednia=mean(wstyd),
            odch=sd(wstyd),
            blad_sr=sd(wstyd)/sqrt(n()))

ggplot(wstyd_wiek4, aes(x = wiek4, 
                        y = srednia)) +
  geom_col() + 
  geom_errorbar(aes(ymin = srednia - odch, 
                    ymax = srednia + odch), 
                width = 0.5)
```

]

---

# Wykres słupkowy - `geom_col`

.pull-left[

```{r eval=FALSE}
wstyd_wiek4_plec <- psycho %>%
  group_by(wiek4,plec) %>%
  summarise(srednia=mean(wstyd),
            odch=sd(wstyd),
            blad_sr=sd(wstyd)/sqrt(n()))

ggplot(wstyd_wiek4_plec, aes(x = wiek4, 
                             y = srednia, 
                             fill = plec)) +
  geom_col(position = "dodge") + 
  geom_errorbar(aes(ymin = srednia - odch, 
                    ymax = srednia + odch), 
                width = 0.5, 
                position = position_dodge(0.9))
```

]

.pull-right[

```{r echo=FALSE}
wstyd_wiek4_plec <- psycho %>%
  group_by(wiek4,plec) %>%
  summarise(srednia=mean(wstyd),
            odch=sd(wstyd),
            blad_sr=sd(wstyd)/sqrt(n()))

ggplot(wstyd_wiek4_plec, aes(x = wiek4, 
                             y = srednia, 
                             fill = plec)) +
  geom_col(position = "dodge") + 
  geom_errorbar(aes(ymin = srednia - odch, 
                    ymax = srednia + odch), 
                width = 0.5, 
                position = position_dodge(0.9))
```

]

---

# `facet_wrap`

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_wrap( ~ plec)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_wrap( ~ plec)
```
]

---

# `facet_wrap`

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_wrap(wiek4 ~ plec)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_wrap(wiek4 ~ plec)
```
]

---

# `facet_wrap`

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_wrap(wiek4 ~ plec, 
             ncol = 2)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_wrap(wiek4 ~ plec,
             ncol = 2)
```

]
---

# `facet_grid`

.pull-left[

```{r eval=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_grid(wiek4 ~ plec)
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_point() +
  facet_grid(wiek4 ~ plec)
```
]

---

class: inverse

# Zadanie

Dla zmiennych wstyd, poczucie_winy, indecisiveness, ruminacja i refleksja oblicz wartości minimum, mediana, średnia, maximum.

`r countdown(minutes = 10, seconds = 0, top = 0)`

???

```{r}
psycho %>%
  summarise_at(vars(wstyd:refleksja), c("min", "median", "mean", "max"))
```

---

# Szeroka i wąska reprezentacja danych

![](img/wide_long.png)

[źródło](https://www.datasciencemadesimple.com%2Freshape-in-r-from-wide-to-long-from-long-to-wide)

---

# Animacja

![](img/tidyr-spread-gather.gif)

[źródło](https://github.com/gadenbuie/tidyexplain)

---

# Wide -> long - `pivot_longer()`

```{r}
psycho_long <- psycho %>%
  select(id, wstyd:refleksja) %>%
  pivot_longer(wstyd:refleksja)

head(psycho_long)
```


???

```{r}
psycho_long %>%
  group_by(name) %>%
  summarise_all(c("min", "median", "mean", "max"))
```

---

# Long -> wide - `pivot_wider()`

```{r}
psycho_wide <- psycho_long %>%
  pivot_wider()

head(psycho_wide)
```

---

# Wykres pudełkowy - `geom_boxplot`

Obowiązkowe argumenty `aes`:

- x - zmienna grupująca (tekstowa/faktor)

- y - zmienna analizowana

---

# Wykres pudełkowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho_long, aes(x=name, y=value)) +
  geom_boxplot()
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho_long, aes(x=name, y=value)) +
  geom_boxplot()
```


]

---

# Wykres pudełkowy

.pull-left[

```{r eval=FALSE}
ggplot(psycho_long, aes(x=name, y=value)) +
  geom_boxplot() +
  coord_flip()
```

]

.pull-right[

```{r echo=FALSE}
ggplot(psycho_long, aes(x=name, y=value)) +
  geom_boxplot()  +
  coord_flip()
```

]

---

class: inverse

# Zadanie

Stwórz następujący wykres wykorzystując długą formę danych

```{r echo=FALSE}

psycho %>%
  select(ps,perf_cmda) %>%
  pivot_longer(ps:perf_cmda) %>%
  ggplot(aes(x=value)) +
  geom_histogram(binwidth = 0.5) +
  xlab("") + ylab("Liczebność") +
  facet_wrap(~ name) +
  theme_light()

```

`r countdown(minutes = 10, seconds = 0, top = 0)`

---

# Pakiet _ggimage_

.pull-left[

```{r eval=FALSE}
library(ggimage)

ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_image(image="img/unicorn2.png", 
             size = 0.07) +
  theme_light() +
  xlim(15,25) + 
  ylim(25,40)
```

]

.pull-right[

```{r echo=FALSE, warning=FALSE}
library(ggimage)

ggplot(psycho, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_image(image = "img/unicorn2.png", size = 0.07) +
  theme_light() +
  xlim(15,25) + ylim(25,40)
```

]

---

# Pakiet _ggimage_

.pull-left[

```{r eval=FALSE}
library(ggimage)

images <- data.frame(plec = c("1", "2"),
                     img = c("img/unicorn.png",
                             "img/rainbow.png"))

psycho_img <- left_join(psycho, images,
                        by = "plec")

ggplot(psycho_img, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_image(aes(image = img), size = 0.07) +
  theme_light() +
  xlim(15,25) + ylim(25,40)
```

]

.pull-right[

```{r echo=FALSE, warning=FALSE}
library(ggimage)

images <- data.frame(plec = c("1", "2"),
                     img = c("img/unicorn.png",
                             "img/rainbow.png"))

psycho_img <- left_join(psycho, images,
                        by = "plec")

ggplot(psycho_img, aes(x = poczucie_winy, 
                   y = wstyd)) +
  geom_image(aes(image = img), size = 0.07) +
  theme_light() +
  xlim(15,25) + ylim(25,40)
```

]


---

class: inverse

# Zadanie domowe

Stwórz następujące wykresy

.pull-left[

```{r echo=FALSE, fig.height=5}
psycho %>%
  mutate(wiek6=cut(wiek,seq(18,42,4),include.lowest = T)) %>%
  ggplot(aes(x=ruminacja, y=refleksja, color = wiek6)) + 
  geom_point() +
  scale_color_discrete(name="Grupy wieku") +
  xlim(0,30) +
  ylim(0,30) +
  theme_classic() +
  theme(legend.position = "top")
```


]

.pull-right[

```{r echo=FALSE, fig.height=5}
psycho %>%
  mutate(wiek6=cut(wiek,seq(18,42,4),include.lowest = T)) %>%
  ggplot(aes(x = wiek6)) + 
  geom_bar(fill = "lightblue") +
  xlab("Grupy wieku") +
  ylab("Liczebność") +
  facet_wrap(~ plec) +
  theme_bw() 
```


]


???

Na podstawie zbioru `pgss2.RData` przeprowadź analizę liczby braków danych dla zmiennych oraz respondentów. Wyniki przedstaw na wykresach.

```{r}
load("data/pgss.RData")

pgss2 <- pgss %>%
  select(recordid:q37)

save(pgss2, file="data/pgss2.RData")
```

